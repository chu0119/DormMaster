# 使用手册

## 📖 系统角色说明

系统包含四种角色，每种角色有不同的权限和功能：

### 1. 管理员 (Admin)
**默认账号**: admin / admin123

**权限**:
- ✅ 所有宿舍楼管理
- ✅ 所有房间管理
- ✅ 所有学生管理
- ✅ 用户账号管理
- ✅ 系统统计和日志
- ✅ 数据导入导出
- ✅ 系统配置

### 2. 教师 (Teacher)
**权限**:
- ✅ 查看管辖学生
- ✅ 查看宿舍分配
- ✅ 查看统计报表
- ❌ 管理功能

### 3. 宿管 (Housekeeper)
**权限**:
- ✅ 管理指定楼栋
- ✅ 查看入住情况
- ✅ 巡查记录
- ❌ 跨楼栋操作

### 4. 学生 (Student)
**权限**:
- ✅ 查看个人信息
- ✅ 查看宿舍分配
- ❌ 修改信息

## 🏠 宿舍管理

### 添加宿舍楼

**路径**: 管理后台 → 宿舍管理 → 楼栋管理 → 添加楼栋

**步骤**:
1. 点击"添加楼栋"按钮
2. 填写信息：
   - **楼栋名称**: 如 "1号楼"
   - **楼栋编码**: 如 "B01"
   - **地址**: 详细地址
   - **楼层数**: 如 "6"
   - **适用性别**: 男/女/混合
3. 点击"保存"

### 批量添加房间

**路径**: 管理后台 → 宿舍管理 → 房间管理 → 批量添加

**步骤**:
1. 选择目标楼栋
2. 设置起始楼层和结束楼层
3. 设置每层房间数（如：每层10间）
4. 设置每个房间床位数（如：4床）
5. 点击"批量创建"

**示例**:
- 楼栋：1号楼
- 起始楼层：1
- 结束楼层：6
- 每层房间数：10
- 床位数：4

**结果**: 创建 60 个房间（101-110, 201-210, ..., 601-610）

### 房间管理

**功能**:
- 查看房间列表
- 查看入住率
- 编辑房间信息
- 设置房间状态（正常/维修/停用）
- 查看房间详情

## 👥 学生管理

### 添加单个学生

**路径**: 管理后台 → 学生管理 → 添加学生

**必填字段**:
- 学号（唯一）
- 姓名
- 性别
- 学院
- 专业
- 班级
- 联系电话
- 身份证号
- 入学日期
- 状态（在读/毕业/休学）

### 批量导入学生

**路径**: 管理后台 → 学生管理 → 批量导入

**步骤**:
1. 下载 CSV 模板
2. 填写学生信息（参考下方格式）
3. 上传 CSV 文件
4. 系统自动检测编码并导入
5. 查看导入结果

**CSV 格式**:
```csv
学号,姓名,性别,学院,专业,班级,联系电话,身份证号,入学日期,状态
2021001,张三,男,计算机学院,软件工程,2021级1班,13800138000,110101200001011234,2021-09-01,在读
2021002,李四,女,计算机学院,网络工程,2021级2班,13900139000,110101200001022345,2021-09-01,在读
```

**编码支持**:
- ✅ UTF-8（推荐）
- ✅ GBK（自动转换）
- ✅ GB2312（自动转换）

### 学生管理功能
- 查看学生列表
- 搜索学生（学号、姓名、学院）
- 编辑学生信息
- 删除学生
- 重置学生密码

## 🛏️ 宿舍分配

### 手动分配（单个）

**路径**: 管理后台 → 宿舍分配 → 单个分配

**步骤**:
1. 选择学生
2. 选择房间
3. 指定床位号
4. 选择入住日期
5. 点击"分配"

### 批量分配（推荐）

**路径**: 管理后台 → 宿舍分配 → 批量分配

**步骤**:
1. **选择目标房间**
   - 选择楼栋和房间
   - 系统显示剩余床位数

2. **搜索学生**
   - 在搜索框输入关键词
   - 支持：学号、姓名、学院、专业
   - 实时显示搜索结果

3. **选择学生**
   - 点击学生卡片选择
   - 或点击"全选"按钮
   - 右侧实时显示已选列表

4. **检查容量**
   - 系统自动计算剩余床位
   - 超出容量会显示红色警告
   - 正常选择显示绿色提示

5. **调整选择**
   - 右侧点击"移除"可删除
   - 点击"清空"按钮重置

6. **确认分配**
   - 点击"批量分配"按钮
   - 确认后提交

**批量分配优势**:
- ✅ 一目了然的双栏布局
- ✅ 实时搜索，无需刷新
- ✅ 容量检查，防止超额
- ✅ 便捷操作，一键全选/清空
- ✅ 已选管理，随时调整

## 📊 数据统计

### 访问路径
管理后台 → 数据统计

### 统计内容

#### 1. 概览统计
- 宿舍楼总数
- 房间总数
- 总床位数
- 已入住人数
- 入住率
- 空余床位
- 维修房间数

#### 2. 楼栋统计
- 各楼栋入住率饼图
- 楼层分布柱状图
- 性别比例图

#### 3. 学生统计
- 按学院统计
- 按专业统计
- 性别比例
- 入住时间分布

#### 4. 可视化图表
- **饼图**: 入住率、性别比例
- **柱状图**: 楼栋分布、楼层分布
- **折线图**: 入住趋势

## 🔑 用户管理

### 添加用户

**路径**: 管理后台 → 用户管理 → 添加用户

**字段**:
- 用户名
- 密码
- 角色（管理员/教师/宿管/学生）
- 关联信息（如教师编号、宿管楼栋）

### 修改密码

**路径**: 管理后台 → 用户管理 → 编辑用户

**步骤**:
1. 找到目标用户
2. 点击"编辑"
3. 输入新密码
4. 保存

### 重置密码

**方法一**: 通过管理后台
1. 进入用户管理
2. 编辑用户
3. 设置新密码

**方法二**: 通过数据库
```sql
UPDATE users
SET password = '$2y$10$...'
WHERE username = '目标用户名';
```
使用 `password_hash('新密码', PASSWORD_DEFAULT)` 生成哈希

## 📝 日志管理

### 访问路径
管理后台 → 系统日志（需管理员权限）

### 日志类型

#### 1. 操作日志 (operation.log)
记录所有关键操作：
- 用户登录/登出
- 数据增删改
- 权限变更
- 批量操作

#### 2. 错误日志 (error.log)
记录系统异常：
- 数据库错误
- PHP错误
- 权限验证失败
- 业务逻辑异常

#### 3. 导入日志 (import.log)
记录CSV导入：
- 导入时间
- 成功/失败数量
- 详细错误信息

### 日志操作
- **查看**: 在线浏览日志内容
- **下载**: 下载完整日志文件
- **清空**: 清空指定日志

## 🔒 安全功能

### CSRF 保护
所有 POST 请求都需要 CSRF 令牌，系统自动处理。

### 密码加密
所有密码使用 `password_hash()` 加密存储。

### 权限验证
每个页面都会验证用户角色和权限。

### 输入验证
- 用户输入自动过滤
- SQL 使用预处理语句
- 输出使用 `h()` 函数转义

## 🎨 界面操作

### 搜索功能
- **全局搜索**: 在列表页顶部搜索框输入关键词
- **实时搜索**: 输入即搜索，无需回车
- **多字段匹配**: 学号、姓名、学院、专业

### 按钮说明
- **添加/新建**: 创建新数据
- **编辑**: 修改现有数据
- **删除**: 删除数据（需确认）
- **批量**: 批量操作
- **导入**: CSV导入
- **导出**: 数据导出
- **返回**: 返回上一页

### 表单操作
- **必填字段**: 标有 * 号
- **实时验证**: 输入时验证格式
- **错误提示**: 红色文字显示错误
- **成功提示**: 绿色文字显示成功

## 📱 移动端使用

系统支持响应式设计，可在手机和平板上使用：

### 手机端特点
- 单列布局
- 触摸友好的按钮
- 折叠菜单
- 简化表格显示

### 操作建议
- 使用现代浏览器（Chrome/Safari/Firefox）
- 保持屏幕亮度适中
- 连接稳定网络

## 💡 使用技巧

### 1. 快速查找学生
```
输入 "2021" → 显示所有2021级学生
输入 "计算机" → 显示计算机学院学生
输入 "张三" → 显示张三
```

### 2. 批量操作
1. 使用搜索筛选目标数据
2. 点击"全选"按钮
3. 执行批量操作

### 3. 容量管理
- 分配前先查看房间剩余床位
- 批量分配时注意红色警告
- 超出容量无法提交

### 4. 数据备份
- 定期导出重要数据
- 保存CSV备份文件
- 记录操作日志

## ❓ 常见问题

### Q: 为什么看不到某些功能？
**A**: 检查你的角色权限，不同角色看到的功能不同

### Q: 搜索不到学生？
**A**:
1. 确认学生已添加
2. 确认学生未被分配
3. 检查搜索关键词是否正确

### Q: 批量分配失败？
**A**:
1. 检查是否选择了房间
2. 检查是否选择了学生
3. 检查是否超出容量
4. 查看错误提示

### Q: CSV 导入乱码？
**A**:
1. 使用 UTF-8 编码保存 CSV
2. 或使用 GBK 编码，系统会自动转换
3. 查看 `logs/import.log`

### Q: 图表不显示？
**A**:
1. 检查是否安装 GD 扩展
2. 检查是否有统计数据
3. 查看浏览器控制台错误

## 📞 技术支持

如遇问题，请查看：
1. **系统日志**: `admin/logs.php`
2. **PHP错误日志**: 服务器日志
3. **浏览器控制台**: F12 查看

---

**版本**: v1.1.0
**最后更新**: 2026-01-05
